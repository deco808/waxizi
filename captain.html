<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>船长的观察室</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
            position: relative;
            padding: 20px;
        }
        
        /* 简洁的背景纹理 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(30, 41, 59, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(30, 41, 59, 0.1) 0%, transparent 20%);
            z-index: -1;
        }
        
        /* 游戏容器 */
        .game-container {
            width: 100%;
            max-width: 900px;
            min-height: 600px;
            background: rgba(15, 23, 42, 0.95);
            border-radius: 12px;
            padding: 30px;
            display: flex;
            flex-direction: column;
            gap: 25px;
            position: relative;
            z-index: 10;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 130, 220, 0.15);
        }
        
        .header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(100, 130, 220, 0.2);
        }
        
        .title {
            font-size: 2.8rem;
            font-weight: 700;
            color: #94a3b8;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        
        .title span {
            color: #60a5fa;
            font-weight: 800;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #94a3b8;
            margin-top: 8px;
            letter-spacing: 0.5px;
        }
        
        .time-display {
            font-size: 5rem;
            text-align: center;
            font-weight: 300;
            color: #60a5fa;
            margin: 10px 0;
            letter-spacing: 3px;
            font-family: 'Courier New', monospace;
        }
        
        .content-area {
            flex-grow: 1;
            background: rgba(30, 41, 59, 0.5);
            padding: 25px;
            border-radius: 8px;
            line-height: 1.8;
            font-size: 18px;
            color: #cbd5e1;
            border: 1px solid rgba(100, 130, 220, 0.1);
            overflow-y: auto;
        }
        
        .input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .search-bar {
            width: 100%;
            padding: 14px 20px;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #3b82f6;
            border-radius: 8px;
            color: #f1f5f9;
            font-size: 18px;
            outline: none;
            transition: all 0.3s;
        }
        
        .search-bar:focus {
            border-color: #60a5fa;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
        }
        
        .info-panel {
            background: rgba(30, 41, 59, 0.7);
            padding: 18px;
            border-radius: 8px;
            font-size: 16px;
            line-height: 1.6;
            border: 1px solid rgba(100, 130, 220, 0.1);
        }
        
        .highlight {
            color: #60a5fa;
            font-weight: 600;
        }
        
        .example {
            color: #60a5fa;
            font-weight: 500;
            background: rgba(30, 41, 59, 0.8);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .action-button {
            padding: 14px 25px;
            background: #1e40af;
            border: none;
            border-radius: 8px;
            color: #f1f5f9;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 5px;
            letter-spacing: 0.5px;
        }
        
        .action-button:hover {
            background: #3b82f6;
            transform: translateY(-2px);
        }
        
        /* 阅读视图样式 */
        .reading-view {
            display: none;
            min-height: 600px;
            padding: 30px;
            background: rgba(15, 23, 42, 0.98);
            border-radius: 12px;
            position: relative;
            border: 1px solid rgba(100, 130, 220, 0.15);
        }
        
        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 20px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #3b82f6;
            border-radius: 6px;
            color: #f1f5f9;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .back-button:hover {
            background: #3b82f6;
        }
        
        .scene-title {
            text-align: center;
            font-size: 2.2rem;
            color: #60a5fa;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(100, 130, 220, 0.2);
            font-weight: 600;
        }
        
        .dialog-text {
            white-space: pre-line;
            line-height: 1.8;
            font-size: 18px;
            background: rgba(30, 41, 59, 0.5);
            padding: 25px;
            border-radius: 8px;
            border: 1px solid rgba(100, 130, 220, 0.1);
            color: #cbd5e1;
        }
        
        .passenger-tag {
            display: inline-block;
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid #3b82f6;
            border-radius: 6px;
            padding: 8px 15px;
            margin: 0 8px 8px 0;
            font-size: 16px;
        }
        
        /* 历史记录面板 */
        .history-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.98);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 130, 220, 0.15);
            z-index: 100;
            overflow-y: auto;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(100, 130, 220, 0.2);
        }
        
        .history-title {
            font-size: 2rem;
            color: #60a5fa;
            font-weight: 600;
        }
        
        .close-history {
            padding: 8px 20px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #3b82f6;
            border-radius: 6px;
            color: #f1f5f9;
            cursor: pointer;
            font-size: 16px;
        }
        
        .close-history:hover {
            background: #3b82f6;
        }
        
        .history-item {
            padding: 15px;
            margin-bottom: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .history-item:hover {
            background: rgba(30, 41, 59, 0.7);
        }
        
        .history-time {
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .history-content {
            line-height: 1.6;
            display: none;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(100, 130, 220, 0.2);
        }
        
        .history-content.show {
            display: block;
        }
        
        /* 乘客信息面板 */
        .passenger-info {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.98);
            width: 90%;
            max-width: 600px;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 130, 220, 0.15);
            z-index: 100;
        }
        
        .passenger-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(100, 130, 220, 0.2);
        }
        
        .passenger-title {
            font-size: 1.8rem;
            color: #60a5fa;
            font-weight: 600;
        }
        
        .close-passenger {
            padding: 8px 20px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #3b82f6;
            border-radius: 6px;
            color: #f1f5f9;
            cursor: pointer;
            font-size: 16px;
        }
        
        .close-passenger:hover {
            background: #3b82f6;
        }
        
        .passenger-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .passenger-item {
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            display: flex;
            align-items: center;
            border-left: 3px solid #3b82f6;
            transition: all 0.2s;
        }
        
        .passenger-item:hover {
            background: rgba(30, 41, 59, 0.7);
            transform: translateX(5px);
        }
        
        .passenger-id {
            width: 40px;
            font-weight: 600;
            color: #60a5fa;
            margin-right: 15px;
            text-align: center;
            font-size: 1.1rem;
        }
        
        .passenger-name {
            flex: 1;
            font-size: 1.1rem;
        }
        
        /* 录像选择面板 */
        .review-panel {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(15, 23, 42, 0.98);
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 130, 220, 0.15);
            z-index: 100;
            overflow-y: auto;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(100, 130, 220, 0.2);
        }
        
        .review-title {
            font-size: 2rem;
            color: #60a5fa;
            font-weight: 600;
        }
        
        .close-review {
            padding: 8px 20px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #3b82f6;
            border-radius: 6px;
            color: #f1f5f9;
            cursor: pointer;
            font-size: 16px;
        }
        
        .close-review:hover {
            background: #3b82f6;
        }
        
        .review-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .review-item {
            padding: 15px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .review-item:hover {
            background: rgba(30, 41, 59, 0.7);
            transform: translateY(-3px);
        }
        
        .review-time {
            font-weight: 600;
            color: #60a5fa;
            margin-bottom: 5px;
            font-size: 1.1rem;
        }
        
        .review-location {
            font-weight: 500;
            color: #94a3b8;
        }
        
        /* 响应式设计 */
        @media (max-width: 950px) {
            .title {
                font-size: 2.2rem;
            }
            
            .time-display {
                font-size: 3.5rem;
            }
            
            .game-container {
                padding: 20px;
            }
        }
        
        @media (max-width: 600px) {
            .title {
                font-size: 1.8rem;
            }
            
            .time-display {
                font-size: 2.8rem;
            }
            
            .content-area, .dialog-text {
                font-size: 16px;
                padding: 15px;
            }
            
            .passenger-details {
                flex-direction: column;
            }
            
            .review-list {
                grid-template-columns: 1fr;
            }
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        /* 内容区域滚动条 */
        .content-area::-webkit-scrollbar,
        .passenger-list::-webkit-scrollbar,
        .history-panel::-webkit-scrollbar,
        .review-panel::-webkit-scrollbar {
            width: 8px;
        }
        
        .content-area::-webkit-scrollbar-track,
        .passenger-list::-webkit-scrollbar-track,
        .history-panel::-webkit-scrollbar-track,
        .review-panel::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 4px;
        }
        
        .content-area::-webkit-scrollbar-thumb,
        .passenger-list::-webkit-scrollbar-thumb,
        .history-panel::-webkit-scrollbar-thumb,
        .review-panel::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 4px;
        }
        
        .content-area::-webkit-scrollbar-thumb:hover,
        .passenger-list::-webkit-scrollbar-thumb:hover,
        .history-panel::-webkit-scrollbar-thumb:hover,
        .review-panel::-webkit-scrollbar-thumb:hover {
            background: #60a5fa;
        }
        
        /* 状态指示器 */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #10b981;
            margin-right: 8px;
        }
        
        /* 拒绝提示 */
        .rejection-message {
            color: #f87171;
            background: rgba(248, 113, 113, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(248, 113, 113, 0.3);
            margin-top: 15px;
        }

             .special-highlight {
            color: #ffcc00 !important;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.3);
            border-bottom: 2px solid #ffcc00;
            padding-bottom: 2px;
        }
        
        /* 结束提示 */
        .ending-message {
            color: #60a5fa;
            background: rgba(96, 165, 250, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(96, 165, 250, 0.3);
            margin-top: 15px;
            text-align: center;
        }
        
        /* 强制邀请对话框 */
        .force-invite-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: #1e293b;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(100, 130, 220, 0.2);
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: #60a5fa;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid #3b82f6;
            border-radius: 8px;
            color: #f1f5f9;
            font-size: 16px;
            outline: none;
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }
        
        .modal-button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
        }
        
        .modal-confirm {
            background: #1e40af;
            color: #f1f5f9;
        }
        
        .modal-confirm:hover {
            background: #3b82f6;
        }
        
        .modal-cancel {
            background: rgba(30, 41, 59, 0.8);
            color: #f1f5f9;
            border: 1px solid #3b82f6;
        }
        
        .modal-cancel:hover {
            background: #3b82f6;
        }
        
        /* 查看所有内容按钮 */
        .view-all-button {
            padding: 12px 20px;
            background: #7e22ce;
            border: none;
            border-radius: 8px;
            color: #f1f5f9;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
            display: none;
        }
        
        .view-all-button:hover {
            background: #a855f7;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="game-container fade-in" id="mainView">
        <div class="header">
            <h1 class="title">船长的<span>观察室</span></h1>
            <div class="subtitle">每一小时，你将有机会观察船上发生的故事</div>
        </div>
        
        <div class="time-display" id="timeDisplay">15:00</div>
        
        <button class="view-all-button" id="viewAllButton" onclick="showAllContent()">查看所有记录</button>
        
        <div class="content-area" id="content">
            <p><span class="status-indicator"></span>欢迎船长来到观察室！现在是下午15:00，航程刚刚开始。</p>
            <br>
            <p>作为船长，你可以邀请乘客到观察室进行观察，或者回看船上其他区域之前发生的录像。</p>
            <br>
            <p>当前可以邀请的乘客有：</p>
            <div style="margin-top: 15px;">
                <span class="passenger-tag">开司 (1)</span>
                <span class="passenger-tag">赤木 (19) (3)</span>
                <span class="passenger-tag">涯 (7)</span>
            </div>
            <br>
            <p>请在输入框中输入操作指令：</p>
            <ul style="padding-left: 20px; margin-top: 10px;">
                <li>邀请乘客：输入乘客编号，如 <span class="example">1-3-7</span></li>
                <li>去其他房间：输入地点，如 <span class="example">餐厅</span></li>
                <li>回看录像：输入时间-地点，如 <span class="example">16-餐厅</span></li>
                <li>查看乘客信息：输入 <span class="example">乘客</span></li>
                <li>查看历史记录：输入 <span class="example">历史</span></li>
                <li>你可以邀请1-4位乘客进入观察室，或回看其他房间的录像</li>
            </ul>
        </div>
        
        <div class="input-section">
            <input type="text" class="search-bar" id="searchBar" placeholder="输入操作指令 (例如：1-3-7 或 餐厅 或 16-餐厅 或 乘客)" autofocus>
            <button class="action-button" onclick="processInput()">执行操作</button>
        </div>
    </div>
    
    <div class="game-container reading-view" id="readingView">
        <button class="back-button" onclick="backToMain()">← 返回</button>
        <div id="readingContent"></div>
    </div>
    
    <!-- 历史记录面板 -->
    <div class="history-panel" id="historyPanel">
        <div class="history-header">
            <h2 class="history-title">船长的观察记录</h2>
            <button class="close-history" onclick="closeHistory()">关闭</button>
        </div>
        <div id="historyContent"></div>
    </div>
    
    <!-- 乘客信息面板 -->
    <div class="passenger-info" id="passengerInfo">
        <div class="passenger-header">
            <h2 class="passenger-title">乘客信息</h2>
            <button class="close-passenger" onclick="closePassengerInfo()">关闭</button>
        </div>
        <div id="passengerContent"></div>
    </div>
    
    <!-- 录像选择面板 -->
    <div class="review-panel" id="reviewPanel">
        <div class="review-header">
            <h2 class="review-title">所有录像记录</h2>
            <button class="close-review" onclick="closeReviewPanel()">关闭</button>
        </div>
        <div id="reviewContent"></div>
    </div>
    
    <!-- 强制邀请对话框 -->
    <div class="force-invite-modal" id="forceInviteModal">
        <div class="modal-content">
            <h3 class="modal-title">强制邀请</h3>
            <p style="margin-bottom: 15px;">您确定要使用强制邀请吗？这将消耗您的唯一机会。</p>
            <input type="text" class="modal-input" id="forceInviteInput" placeholder="输入要邀请的乘客编号或名字">
            <div class="modal-buttons">
                <button class="modal-button modal-cancel" onclick="cancelForceInvite()">取消</button>
                <button class="modal-button modal-confirm" onclick="confirmForceInvite()">确认邀请</button>
            </div>
        </div>
    </div>
    
    <script>
       
       // 修改后的场景数据
const scenes = {
    // 观察室场景（保持不变）
    "15-观察室-1-3": {
        title: "开司与赤木的对话",
        content: `赤木先进入房间，没过几分钟，开司也进来了

开司：你好啊，我是开司，你就是船长吗？

赤木：我不是

开司：诶，那你也是船长邀请来的？

赤木：是这样

开司：那船长在哪里呢？

赤木没有说话，向你这边看了一眼`
    },
    // 其他观察室场景...
    
    // 餐厅场景（使用时间段范围）
    "15-18-餐厅": {
        title: "餐厅的日常",
        content: `餐厅里总是人来人往，乘客们在这里用餐、交谈。

服务生：今天的特色菜是海鲜意面，需要来一份吗？

乘客们各自选择自己喜欢的食物，餐厅里充满了餐具碰撞和轻声交谈的声音。

在这里，你可以观察到乘客们的日常互动和饮食习惯。`
    },
    
    // 甲板场景（使用时间段范围）
    "15-20-甲板": {
        title: "甲板风光",
        content: `甲板上，乘客们欣赏着海景，感受海风。

一些乘客在散步，一些坐在躺椅上休息，还有一些在拍照留念。

海鸥在空中盘旋，偶尔发出叫声，与海浪声交织在一起。`
    },
    
    // 酒吧场景（使用时间段范围）
    "17-24-酒吧": {
        title: "酒吧时光",
        content: `夜晚的酒吧总是格外热闹，乘客们在这里放松、社交。

酒保熟练地调製着各种饮品，钢琴师演奏着轻柔的爵士乐。

一些乘客独自小酌，一些成群结队地聊天玩游戏。`
    }
};
        // 乘客数据
        const passengers = {
            "1": { name: "开司" },
            "2": { name: "和也" },
            "3": { name: "赤木(19岁)" },
            "4": { name: "赤木(13岁)" },
            "5": { name: "赤木(53岁)" },
            "6": { name: "零" },
            "7": { name: "涯" },
            "8": { name: "平山" },
            "9": { name: "一条-村上" },
            "10": { name: "鹫巢-隼"},
            "11": { name: "银二-森田" }
        };
        
        // 当前时间（15:00开始）
        let currentTime = 15;
        let dayCount = 1; // 天数计数器
        
        // 历史记录
        let history = [];
        
        // 强制邀请是否已使用
        let forceInviteUsed = false;
        
        // 获取当前时间段可邀请的乘客ID
        function getAvailablePassengerIds() {
            if (currentTime === 15 && dayCount === 1) {
                return ["1", "3", "7"];
            } else if (currentTime === 16 && dayCount === 1) {
                return ["6", "8", "11"];
            } else if (currentTime === 17 && dayCount === 1) {
                return ["4", "5", "10"];
            }else if (currentTime === 18 && dayCount === 1) {
                return ["4", "5", "10"];
            }else if (currentTime === 19 && dayCount === 1) {
                return ["4", "5", "10"];
            }else if (currentTime === 20 && dayCount === 1) {
                return ["4", "5", "10"];
            }else if (currentTime === 21 && dayCount === 1) {
                return ["4", "5", "10"];
            }else if (currentTime === 22 && dayCount === 1) {
                return ["4", "5", "10"];
            }else if (currentTime === 23 && dayCount === 1) {
                return ["4", "5", "10"];
            }else if (currentTime === 24 && dayCount === 1) {
                return ["4", "5", "10"];
            }else if (currentTime === 1 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 2 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 3 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 4 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 5 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 6 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 7 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 8 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 9 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 10 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 11 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 12 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 13 && dayCount === 2) {
                return ["4", "5", "10"];
            }else if (currentTime === 14 && dayCount === 2) {
                return ["4", "5", "10"];
            }
            return []; // 第二天及以后不再有可邀请的乘客
        }
const timeSpecificContent = {
    1: { // 第一天
        15: `
                <p><span class="special-highlight">欢迎上船！船长！</span></p>
                <br>
                <p>您既然能点进这个游戏，想必也听说过<span class="special-highlight">希望号</span>的大名吧</p>
                <br>
                <p>没错，现在您就是豪华游轮，希望号的船长了！</p>
                <br>
                <p>今天，您的船被一位富有的企业家承包了下来，进行一次为期一天的游轮之旅</p>
                <br>
                <p>您的船上共有<span class="special-highlight">14</span>位乘客，分别住在<span class="special-highlight">11</span>间房间内，在输入框中输入<span class="special-highlight">乘客</span>二字即可查看乘客信息</p>
                <br>
                <p>您对他们的游轮之旅感兴趣吗？呵呵，或许您还记得，希望号上那无处不在的单向玻璃吧</p>
                <br>
                <p>依照雇主的要求，您不能直接参与乘客们的旅程，但作为船长，您可以通过那些单向玻璃观察他们的故事</p>
                <br>
                <p>在您的船长室中，也有这样一个安装了单向玻璃的观察室</p>
                <br>
                <p>您可以依照自己的喜好，将您希望观察的对象邀请到观察室里来，有时还可以做一些小小的互动</p>
                <br>
               
            <p>在真的开始您的观察旅程之前，我有一些小的注意事项需要提醒：</p>
                    <br>
                
            <p>首先，您<span class="special-highlight">每隔一小时</span>才可以选择一次行动，除了<span class="special-highlight">邀请乘客</span>来观察室外，您还可以选择<span class="special-highlight">去其他房间</span>，或者<span class="special-highlight">回看</span>其他房间的录像，这些行动都会<span class="special-highlight">持续一个小时</span>的时间</p>
                        <br>
            <p>第二，您每次只能邀请<span class="special-highlight">1-4</span>位乘客进入观察室，会有明确的提示告诉您哪些乘客可以被邀请，请不要打扰无法被邀请的乘客，有部分乘客是<span class="special-highlight">互相绑定</span>的，您输入他们的编号后会一次性邀请进来两个人，这在乘客信息里都有写</p>
                        <br>
             <p>第三，若您想回顾之前曾经看过的内容，可以在输入框中输入<span class="special-highlight">历史</span>二字，这个操作不花费时间</p>
                        <br>
             <p>第四，船上有哪些房间，具体在什么时候会有人，这些您都无法提前得知（或许您能知道房间，但有没有人这个谁都不知道），您可以通过角色之间的对话<span class="special-highlight">推理</span>一下，旅行结束后会给您机会观看船上曾发生过的所有内容</p>
                        <br>
            <p>第五，您在此次航行中，<span class="special-highlight">有且仅有一次</span>机会绕过第二条的限制，邀请您想邀请的<span class="special-highlight">任意两位</span>乘客进入观察室做一些或许跟您想象地不一样，但差不多的事，由于性质过于恶劣，之后所有的乘客都会拒绝您的邀请，您选择会影响故事的发展，请谨言慎行</p>
                        <br>
             <p>第六，本游戏<span class="special-highlight">没有存档功能</span>，无意外尽量不要刷新</p>
                        <br>
            <p>最后，您的观察旅程将持续24小时，第二天之后，乘客们将会下船，您的观察之旅也将结束</p>
                    
                <br>
                <p>好了，船长，现在是下午15:00，航程刚刚开始，请享受您的旅程吧</p>
            `, // 原有内容
        16: "阳光正好，许多乘客在甲板上欣赏海景。",
        17: "傍晚时分，乘客们开始前往餐厅准备用晚餐。",
        // 其他时间点...
    },
    2: { // 第二天
        1: "第二天早晨，乘客们陆续醒来享用早餐。",
        2: "乘客们开始整理行李准备下船。",
        3: "航程结束，所有乘客已下船。",
        // 其他时间点...
    }
    // 可扩展更多天数
};
    
// 查找场景的函数
function findScene(key) {
    // 先尝试精确匹配
    if (scenes[key]) {
        return scenes[key];
    }
    
    // 如果不是精确匹配，尝试时间段范围匹配
    const parts = key.split('-');
    const currentTime = parseInt(parts[0]);
    const currentLocation = parts.slice(1).join('-');
    
    for (const sceneKey in scenes) {
        const sceneParts = sceneKey.split('-');
        
        // 检查是否是时间段范围格式（如"15-18-餐厅"）
        if (sceneParts.length >= 3 && !isNaN(sceneParts[0]) && !isNaN(sceneParts[1])) {
            const startTime = parseInt(sceneParts[0]);
            const endTime = parseInt(sceneParts[1]);
            const location = sceneParts.slice(2).join('-');
            
            if (location === currentLocation && currentTime >= startTime && currentTime <= endTime) {
                return scenes[sceneKey];
            }
        }
    }
    
    return null;
}

function updateTime() {
    // 更新时间显示
    document.getElementById('timeDisplay').textContent = 
        `${currentTime.toString().padStart(2, '0')}:00`;
    
    // 获取当前天的特定时间描述
    const dayContent = timeSpecificContent[dayCount] || {};
    
    // 获取当前时间的特定描述（优先使用特定描述）
    const timeDescription = dayContent[currentTime] || 
        `现在是第${dayCount}天 ${currentTime.toString().padStart(2, '0')}:00`;
    
    // 获取当前可邀请的乘客
    const availableIds = getAvailablePassengerIds();
    
    // 更新内容区域
    const content = document.getElementById('content');
    
    if (availableIds.length > 0) {
        content.innerHTML = `
            <p><span class="status-indicator"></span>${timeDescription}</p>
            <br>
            <p>当前可以邀请的乘客有：</p>
            <div style="margin-top: 15px;">
                ${availableIds.map(id => 
                    `<span class="passenger-tag">${passengers[id].name} (${id})</span>`
                ).join('')}
            </div>
            <br>
            <p>请在输入框中输入操作指令：</p>
            <ul style="padding-left: 20px; margin-top: 10px;">
                <li>邀请乘客：输入乘客编号，如 <span class="example">1-3-7</span></li>
                <li>去其他房间：输入地点，如 <span class="example">餐厅</span></li>
                <li>回看录像：输入时间-地点，如 <span class="example">16-餐厅</span></li>
                <li>查看乘客信息：输入 <span class="example">乘客</span></li>
                <li>查看历史记录：输入 <span class="example">历史</span></li>
                ${!forceInviteUsed ? '<li>强制邀请：输入 <span class="example">强制邀请</span></li>' : ''}
            </ul>
        `;
    } else {
        content.innerHTML = `
            <p><span class="status-indicator"></span>${timeDescription}</p>
            <br>
            <div class="ending-message">
                <p>当前时间没有可邀请的乘客。</p>
                <p>你可以回看其他地点的录像。</p>
            </div>
            <br>
            <p>请在输入框中输入操作指令：</p>
            <ul style="padding-left: 20px; margin-top: 10px;">
                <li>去其他房间：输入地点，如 <span class="example">餐厅</span></li>
                <li>回看录像：输入时间-地点，如 <span class="example">16-餐厅</span></li>
                <li>查看乘客信息：输入 <span class="example">乘客</span></li>
                <li>查看历史记录：输入 <span class="example">历史</span></li>
                ${!forceInviteUsed ? '<li>强制邀请：输入 <span class="example">强制邀请</span></li>' : ''}
            </ul>
        `;
    }
    
    // 第二天15:00后显示查看所有内容按钮
    if (dayCount === 2 && currentTime >= 15) {
        document.getElementById('viewAllButton').style.display = 'block';
    } else {
        document.getElementById('viewAllButton').style.display = 'none';
    }
    
    // 确保输入框保持焦点
    document.getElementById('searchBar').focus();
}

        // 添加历史记录
        function addHistory(type, title, content) {
            history.push({
                time: new Date().toLocaleTimeString(),
                gameTime: `第${dayCount}天 ${currentTime.toString().padStart(2, '0')}:00`,
                type: type,
                title: title,
                content: content
            });
        }
        
        // 显示历史记录
        function showHistory() {
            const historyContent = document.getElementById('historyContent');
            
            if (history.length === 0) {
                historyContent.innerHTML = `<p>暂无观察记录，请开始你的观察之旅。</p>`;
                document.getElementById('historyPanel').style.display = 'block';
                return;
            }
            
            let html = '';
            history.forEach((record, index) => {
                html += `
                    <div class="history-item" onclick="toggleHistoryContent(${index})">
                        <div class="history-time">${record.time} (游戏时间: ${record.gameTime}) - ${record.type}</div>
                        <strong>${record.title}</strong>
                        <div class="history-content" id="history-content-${index}">
                            <p>${record.content.replace(/\n/g, '<br>')}</p>
                        </div>
                    </div>
                `;
            });
            
            historyContent.innerHTML = html;
            document.getElementById('historyPanel').style.display = 'block';
        }
        
        // 切换历史记录内容的显示/隐藏
        function toggleHistoryContent(index) {
            const content = document.getElementById(`history-content-${index}`);
            content.classList.toggle('show');
        }
        
        // 显示乘客信息
        function showPassengerInfo(passengerId) {
            const passengerContent = document.getElementById('passengerContent');
            
            // 如果只输入"乘客"，显示所有乘客信息
            if (passengerId === "all") {
                let html = `<h3 class="passenger-title">全体乘客名单</h3>`;
                html += `<div class="passenger-list">`;
                
                for (const [id, info] of Object.entries(passengers)) {
                    html += `
                        <div class="passenger-item">
                            <span class="passenger-id">${id}</span>
                            <span class="passenger-name">${info.name}</span>
                        </div>
                    `;
                }
                
                html += `</div>`;
                passengerContent.innerHTML = html;
                document.getElementById('passengerInfo').style.display = 'block';
                return;
            }
            
        }
        
        // 显示录像选择面板
        function showReviewPanel() {
            const reviewContent = document.getElementById('reviewContent');
            
            let html = '<div class="review-list">';
            
            // 获取所有非观察室的场景
            const reviewScenes = Object.entries(scenes).filter(([key]) => !key.includes('观察室'));
            
            if (reviewScenes.length === 0) {
                html += `<p>暂无录像记录。</p>`;
            } else {
                reviewScenes.forEach(([key, scene]) => {
                    const [time, location] = key.split('-');
                    html += `
                        <div class="review-item" onclick="selectReview('${key}')">
                            <div class="review-time">${time}:00</div>
                            <div class="review-location">${location}</div>
                            <div>${scene.title}</div>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            reviewContent.innerHTML = html;
            document.getElementById('reviewPanel').style.display = 'block';
        }
        
        // 选择录像
        function selectReview(sceneKey) {
            closeReviewPanel();
            showReadingView(scenes[sceneKey].title, scenes[sceneKey].content);
            addHistory('回看', scenes[sceneKey].title, `回看录像: ${sceneKey}\n\n${scenes[sceneKey].content}`);
        }
        
        // 关闭录像选择面板
        function closeReviewPanel() {
            document.getElementById('reviewPanel').style.display = 'none';
            document.getElementById('searchBar').focus();
        }
        
        // 显示所有内容（第二天15:00后）
        function showAllContent() {
            const reviewContent = document.getElementById('reviewContent');
            
            let html = '<div class="review-list">';
            
            // 获取所有场景
            const allScenes = Object.entries(scenes);
            
            if (allScenes.length === 0) {
                html += `<p>暂无任何记录。</p>`;
            } else {
                allScenes.forEach(([key, scene]) => {
                    const parts = key.split('-');
                    const time = parts[0];
                    const location = parts[1];
                    html += `
                        <div class="review-item" onclick="selectReview('${key}')">
                            <div class="review-time">${time}:00</div>
                            <div class="review-location">${location}</div>
                            <div>${scene.title}</div>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            reviewContent.innerHTML = html;
            document.getElementById('reviewPanel').style.display = 'block';
        }

        
        
        // 处理用户输入
        function processInput() {
            const input = document.getElementById('searchBar').value.trim();
            if (!input) {
                alert('请输入操作指令！');
                return;
            }
            
            // 处理查看历史记录指令
            if (input === '历史' || input.toLowerCase() === 'history') {
                showHistory();
                document.getElementById('searchBar').value = '';
                return;
            }
            
            // 处理查看乘客信息指令
            if (input.startsWith('乘客')) {
                const parts = input.split(' ');
                
                // 只输入"乘客"时显示所有乘客
                if (parts.length === 1) {
                    showPassengerInfo("all");
                    document.getElementById('searchBar').value = '';
                    return;
                }
                
                // 输入"乘客 [编号]"时显示单个乘客
                const passengerId = parts[1];
                showPassengerInfo(passengerId);
                document.getElementById('searchBar').value = '';
                return;
            }
            
            // 处理强制邀请指令
            if (input === '强制邀请' && !forceInviteUsed) {
                document.getElementById('forceInviteModal').style.display = 'flex';
                document.getElementById('forceInviteInput').focus();
                return;
            }
            
            // 判断是邀请乘客、回看录像还是前往地点
            if (/^\d+(-\d+)*$/.test(input)) {
                // 邀请乘客
                // 第二天15:00之后不能再邀请乘客
                if (dayCount > 1) {
                    alert('乘客已经下船，无法再邀请他们到观察室。');
                    document.getElementById('searchBar').value = '';
                    return;
                }
                
                const passengerIds = input.split('-');
                
                // 验证输入
                if (passengerIds.length < 1 || passengerIds.length > 4) {
                    alert('一次只能邀请1-4位乘客！');
                    return;
                }
                
                // 检查乘客ID是否有效
                const invalidIds = passengerIds.filter(id => !passengers[id]);
                if (invalidIds.length > 0) {
                    alert(`无效的乘客ID: ${invalidIds.join(', ')}`);
                    return;
                }
                
                // 检查是否所有乘客都可邀请
                const availableIds = getAvailablePassengerIds();
                const unavailableIds = passengerIds.filter(id => !availableIds.includes(id));
                
                if (unavailableIds.length > 0) {
                    const unavailableNames = unavailableIds.map(id => passengers[id].name).join(', ');
                    const content = document.getElementById('content');
                    content.innerHTML += `
                        <div class="rejection-message">
                            <p>${unavailableNames}拒绝了你的邀请，他们目前不方便。</p>
                            <p>请尝试邀请其他乘客。</p>
                        </div>
                    `;
                    document.getElementById('searchBar').value = '';
                    return;
                }
                
                // 获取乘客名字
                const passengerNames = passengerIds.map(id => passengers[id].name);
                
                // 生成场景键（当前时间-观察室-乘客ID）
                const sceneKey = `${currentTime}-观察室-${passengerIds.join('-')}`;
                
                // 在处理邀请乘客的部分，修改场景查找

// 修改为：
const scene = findScene(sceneKey);
if (scene) {
    showReadingView(scene.title, scene.content);
    addHistory('邀请', scene.title, `邀请乘客: ${passengerNames.join(', ')}\n\n${scene.content}`);
} else {
    // 如果场景不存在，使用默认场景
    const title = `观察室 - ${passengerNames.join('、')}`;
    const content = `你邀请了${passengerNames.join('、')}进入观察室。\n\n` +
        `${passengerNames[0]}：船长把我们叫到这里，是有什么特别的事吗？\n` +
        `${passengerNames[1]}：也许只是想观察我们的互动...\n` +
        `${passengerNames[2] ? passengerNames[2] + '：' : ''}${passengerNames[2] ? '这确实是个有趣的地方...' : ''}\n\n` +
        `他们开始交谈，你通过单向玻璃静静地观察着...`;
    
    showReadingView(title, content);
    addHistory('邀请', title, `邀请乘客: ${passengerNames.join(', ')}\n\n${content}`);
}
                
                // 推进时间
                advanceTime();
                
            } else if (/^\d{1,2}-[\u4e00-\u9fa5a-zA-Z]+$/.test(input)) {
                // 回看录像 - 修复时间逻辑
                const [inputTime, location] = input.split('-');
                const timeNum = parseInt(inputTime);
                
                // 检查输入的时间是否有效（小于等于当前时间）
                if (timeNum > currentTime && dayCount === 1) {
                    alert('无法查看未来的录像！只能查看当前时间及之前的录像。');
                    document.getElementById('searchBar').value = '';
                    return;
                }
                
                let found = false;
                
               const scene = findScene(input);
if (scene) {
    showReadingView(scene.title, scene.content);
    addHistory('回看', scene.title, `回看录像: ${input}\n\n${scene.content}`);
    found = true;
    // 回看录像也消耗时间
    advanceTime();
} else {
    alert('未找到相关记录！请检查输入格式是否正确。');
}
                
                if (!found) {
                    alert('未找到相关记录！请检查输入格式是否正确。');
                }
            } else if (/^[\u4e00-\u9fa5a-zA-Z]+$/.test(input)) {
                // 纯地点输入，导向当前时间对应地点的内容
                const sceneKey = `${currentTime}-${input}`;
                
                let found = false;
                
                // 在前往地点的部分，修改场景查找

const scene = findScene(sceneKey);
if (scene) {
    showReadingView(scene.title, scene.content);
    addHistory('前往', scene.title, `前往: ${input}\n\n${scene.content}`);
    found = true;
    // 前往地点消耗时间
    advanceTime();
} else {
    // 如果找不到当前时间该地点的内容，显示提示
    const content = document.getElementById('content');
    content.innerHTML += `
        <div class="rejection-message">
            <p>${currentTime}:00时，${input}没有发生值得记录的事件。</p>
        </div>
    `;
}
                
                if (!found) {
                    // 如果找不到当前时间该地点的内容，显示提示
                    const content = document.getElementById('content');
                    content.innerHTML += `
                        <div class="rejection-message">
                            <p>${currentTime}:00时，${input}没有发生值得记录的事件。</p>
                        </div>
                    `;
                }
            } else {
                    alert('输入格式不正确！');
            }
            
            // 清空输入框
            document.getElementById('searchBar').value = '';
        }
        
        // 推进时间
        function advanceTime() {
            currentTime = (currentTime % 24) + 1;
            
            // 检查是否到了第二天
            if (currentTime === 15 && dayCount === 1) {
                dayCount = 2;
            }
            
            updateTime();
        }
        
        // 显示阅读视图
        function showReadingView(title, content) {
            const readingContent = document.getElementById('readingContent');
            readingContent.innerHTML = `
                <h2 class="scene-title">${title}</h2>
                <div class="dialog-text">${content}</div>
            `;
            document.getElementById('mainView').style.display = 'none';
            document.getElementById('readingView').style.display = 'flex';
        }
        
        // 返回主界面
        function backToMain() {
            document.getElementById('readingView').style.display = 'none';
            document.getElementById('mainView').style.display = 'flex';
            document.getElementById('searchBar').focus();
        }
        
        // 关闭历史记录面板
        function closeHistory() {
            document.getElementById('historyPanel').style.display = 'none';
            document.getElementById('searchBar').focus();
        }
        
        // 关闭乘客信息面板
        function closePassengerInfo() {
            document.getElementById('passengerInfo').style.display = 'none';
            document.getElementById('searchBar').focus();
        }
        
        // 解析乘客输入，支持多种格式
function parsePassengerInput(input) {
    // 移除可能的中文括号和空格
    input = input.replace(/[（）()\s]/g, '');
    
    // 支持多种分隔符：逗号、空格、顿号、分号、横杠
    const separators = /[,\s、；;-]/;
    let passengerIdentifiers = [];
    
    if (separators.test(input)) {
        passengerIdentifiers = input.split(separators).filter(id => id !== '');
    } else {
        passengerIdentifiers = [input];
    }
    
    // 转换为乘客ID
    const passengerIds = [];
    
    for (const identifier of passengerIdentifiers) {
        // 如果是数字，直接作为ID
        if (/^\d+$/.test(identifier)) {
            if (passengers[identifier]) {
                passengerIds.push(identifier);
            }
        } 
        // 否则尝试按名字查找
        else {
            for (const [id, info] of Object.entries(passengers)) {
                // 移除名字中的括号和空格后再比较
                const cleanName = info.name.replace(/[（）()\s]/g, '');
                const cleanIdentifier = identifier.replace(/[（）()\s]/g, '');
                
                if (cleanName.includes(cleanIdentifier) || cleanIdentifier.includes(cleanName)) {
                    passengerIds.push(id);
                    break;
                }
            }
        }
    }
    
    return passengerIds;
}

// 强制邀请相关函数
function cancelForceInvite() {
    document.getElementById('forceInviteModal').style.display = 'none';
    document.getElementById('forceInviteInput').value = '';
    document.getElementById('searchBar').focus();
}

function confirmForceInvite() {
    const input = document.getElementById('forceInviteInput').value.trim();
    if (!input) {
        alert('请输入要邀请的乘客编号或名字！');
        return;
    }
    
    // 解析乘客输入
    const passengerIds = parsePassengerInput(input);
    
    // 检查是否找到了乘客
    if (passengerIds.length === 0) {
        alert('未找到匹配的乘客！请检查输入是否正确。');
        return;
    }
    
    // 强制邀请只能邀请两位乘客
    if (passengerIds.length !== 2) {
        alert('强制邀请只能邀请两位乘客！请准确输入两位乘客的编号或名字。');
        return;
    }
    
    // 获取乘客名字
    const passengerNames = passengerIds.map(id => passengers[id].name);
    
    // 生成场景键（当前时间-观察室-乘客ID）
    const sceneKey = `${currentTime}-观察室-${passengerIds.join('-')}`;
    
    // 查找场景
    if (scenes[sceneKey]) {
        showReadingView(scenes[sceneKey].title, scenes[sceneKey].content);
        addHistory('强制邀请', scenes[sceneKey].title, `强制邀请乘客: ${passengerNames.join(', ')}\n\n${scenes[sceneKey].content}`);
    } else {
        // 如果场景不存在，使用默认场景
        const title = `观察室 - ${passengerNames.join('、')}`;
        const content = `你强制邀请了${passengerNames.join('、')}进入观察室。\n\n` +
            `${passengerNames[0]}：船长，这是什么意思？我们并不想现在来这里。\n` +
            `${passengerNames[1]}：这不太合适吧...\n\n` +
            `他们显得很不情愿，气氛变得紧张...`;
        
        showReadingView(title, content);
        addHistory('强制邀请', title, `强制邀请乘客: ${passengerNames.join(', ')}\n\n${content}`);
    }
    
    // 标记强制邀请已使用
    forceInviteUsed = true;
    
    // 关闭对话框
    document.getElementById('forceInviteModal').style.display = 'none';
    document.getElementById('forceInviteInput').value = '';
    
    // 推进时间
    advanceTime();
    
    // 清空输入框
    document.getElementById('searchBar').value = '';
}
        
        // 初始化
window.onload = function() {
  updateTime();
  document.getElementById('searchBar').focus();
  
  // 支持按Enter键提交
  document.getElementById('searchBar').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
      processInput();
    }
  });
};
    </script>
</body>
</html>