<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鹫巢外传</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6b8cae;
            --accent-color: #ffcc00;
            --light-bg: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #333333;
            --border-color: #d1e3f6;
            --talk-bg: #eef7ff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
        }
        
        body {
            background: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            transition: padding 0.3s ease;
            padding-bottom: 60px; /* 为状态栏预留空间 */
        }

                /* 导航提示样式 */
        .nav-hint {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 204, 0, 0.9);
            color: #16213e;
            padding: 15px 25px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            z-index: 1000;
            animation: fadeInUp 0.5s ease, pulse 2s infinite;
        }

        .nav-hint i {
            margin-right: 10px;
            font-size: 1.4rem;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translate(-50%, 30px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        @keyframes pulse {
            0% { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
            50% { box-shadow: 0 5px 25px rgba(255, 204, 0, 0.5); }
            100% { box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); }
        }

        .hint-enter {
            animation: fadeInUp 0.5s ease;
        }

        .hint-exit {
            animation: fadeOutDown 0.5s ease forwards;
        }

        @keyframes fadeOutDown {
            from {
                opacity: 1;
                transform: translate(-50%, 0);
            }
            to {
                opacity: 0;
                transform: translate(-50%, 30px);
            }
        }
        
        .header {
            padding: 20px;
            text-align: center;
            background: var(--card-bg);
            border-bottom: 2px solid var(--primary-color);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .title {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .notice {
            background: linear-gradient(to right, #b30000, #cc0000);
            color: #fff;
            font-weight: bold;
            padding: 14px;
            text-align: center;
            max-width: 800px;
            margin: 20px auto;
            border-radius: 8px;
            border: 2px solid #ff5252;
            box-shadow: 0 0 15px rgba(255, 82, 82, 0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 10px rgba(255, 82, 82, 0.3); }
            50% { box-shadow: 0 0 20px rgba(255, 82, 82, 0.6); }
            100% { box-shadow: 0 0 10px rgba(255, 82, 82, 0.3); }
        }
        
        .comic-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 15px;
        }
        
        .comic-image {
            display: block;
            width: 100%;
            height: auto;
            margin-bottom: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .comic-image.loaded {
            opacity: 1;
            transform: translateY(0);
        }
        
        .loading-container {
            text-align: center;
            padding: 50px 20px;
            color: #6c757d;
            font-size: 1.2rem;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(74, 111, 165, 0.2);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 碎碎念区域样式 */
        .talk-section {
            background: var(--talk-bg);
            border-radius: 10px;
            padding: 25px;
            margin: 30px auto;
            max-width: 800px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }
        
        .talk-content {
            line-height: 1.8;
            font-size: 1.1rem;
        }
        
        .talk-content p {
            margin-bottom: 15px;
        }
        
        .footer {
            background: var(--card-bg);
            padding: 30px 20px;
            text-align: center;
            margin-top: 30px;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .footer-title {
            color: var(--primary-color);
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .staff-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .staff-item {
            background: #f8fbff;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .staff-role {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .staff-name {
            font-size: 1.1rem;
            color: #555;
        }
        
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px;
            font-size: 1rem;
            text-align: center;
            color: var(--primary-color);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            z-index: 100;
            transition: transform 0.3s ease;
            border-top: 1px solid var(--border-color);
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .progress-container {
            width: 200px;
            height: 8px;
            background: rgba(74, 111, 165, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .completed-message {
            color: #28a745;
            font-weight: bold;
            display: none;
        }
        
        /* 导航菜单样式 */
        .nav-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .nav-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .nav-buttons {
            display: flex;
            gap: 30px;
        }
        
        .nav-btn {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #fff;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .nav-btn i {
            font-size: 2.5rem;
            margin-bottom: 8px;
        }
        
        .nav-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }
        
        .nav-btn.prev {
            border-color: var(--primary-color);
        }
        
        .nav-btn.next {
            border-color: var(--primary-color);
        }
        
        .nav-btn.center {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .nav-btn.center:hover {
            background: #3a5a80;
        }
        
        .nav-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .nav-btn.disabled:hover {
            transform: none;
            background: #fff;
            color: var(--primary-color);
        }
        
        /* 隐藏页眉页脚的状态 */
        .header.hidden {
            transform: translateY(-100%);
        }
        
        .footer.hidden, .status-bar.hidden {
            transform: translateY(100%);
        }
        
        /* 最后一页检测 */
        .end-indicator {
            height: 1px;
            position: absolute;
            bottom: 300px; /* 在底部留出空间 */
            width: 100%;
        }
        
        @media (max-width: 600px) {
            .title {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .staff-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 20px;
            }
            
            .nav-btn {
                width: 80px;
                height: 80px;
                font-size: 0.9rem;
            }
            
            .nav-btn i {
                font-size: 2rem;
            }
            
            .talk-section {
                padding: 20px;
                margin: 20px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header" id="header">
        <div class="title" id="chapterTitle">鹫巢外传</div>
        <div class="subtitle" id="chapterSubtitle">中文汉化版 | Cloudinary CDN加速</div>
    </div>
    
    <div class="notice">
        本汉化仅作学习参考交流使用，不可以任何形式进行盈利。
    </div>
    
    <div class="comic-container" id="comic-container">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>正在加载漫画，请稍候...</p>
            <p><i class="fas fa-cloud"></i> 使用Cloudinary CDN加速中</p>
        </div>
    </div>
    
    <!-- 碎碎念区域 -->
    <div class="talk-section" id="talkSection">
        <div class="talk-content" id="talkContent">
            <!-- 由JavaScript动态生成 -->
        </div>
    </div>
    
    <div class="footer" id="footer">
        <div class="footer-title">制作人员</div>
        <div class="staff-grid" id="staffGrid">
            <!-- 由JavaScript动态生成 -->
        </div>
    </div>
    
    <div class="status-bar" id="statusBar">
        <i class="fas fa-spinner fa-spin"></i>
        <span>加载进度: <span id="loadedCount">0</span>/<span id="totalCount">0</span></span>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <span class="completed-message" id="completedMessage"><i class="fas fa-check-circle"></i> 加载完成!</span>
    </div>
    
    <!-- 导航菜单 -->
    <div class="nav-overlay" id="navOverlay">
        <div class="nav-buttons">
            <div class="nav-btn prev" id="prevBtn">
                <i class="fas fa-arrow-left"></i>
                上一章
            </div>
            <div class="nav-btn center" id="homeBtn">
                <i class="fas fa-home"></i>
                目录
            </div>
            <div class="nav-btn next" id="nextBtn">
                <i class="fas fa-arrow-right"></i>
                下一章
            </div>
        </div>
    </div>
    
    <!-- 最后一页检测元素 -->
    <div class="end-indicator" id="endIndicator"></div>
    
<script>
            // 显示导航提示
        function showNavHint() {
            // 创建提示元素
            const hint = document.createElement('div');
            hint.className = 'nav-hint hint-enter';
            hint.innerHTML = '<i class="fas fa-hand-pointer"></i> 点击页面任意位置显示导航菜单';
            document.body.appendChild(hint);
            
            // 3秒后自动隐藏
            const hideTimer = setTimeout(() => {
                hint.classList.remove('hint-enter');
                hint.classList.add('hint-exit');
                
                // 动画结束后移除元素
                setTimeout(() => {
                    if (document.body.contains(hint)) {
                        document.body.removeChild(hint);
                    }
                }, 500);
            }, 5000);
            
            // 点击页面时立即隐藏提示
            document.body.addEventListener('click', function hideOnClick() {
                clearTimeout(hideTimer);
                hint.classList.remove('hint-enter');
                hint.classList.add('hint-exit');
                
                setTimeout(() => {
                    if (document.body.contains(hint)) {
                        document.body.removeChild(hint);
                    }
                    // 移除事件监听
                    document.body.removeEventListener('click', hideOnClick);
                }, 500);
            }, { once: true });
        }

        // 页面加载完成后显示提示
        document.addEventListener('DOMContentLoaded', showNavHint);
        // ========================
        // 配置区域 - 只需修改这部分
        // ========================
        
        // 当前章节配置
        const chapterConfig = {
            chapterNumber: 30, // 当前章节号
            chapterTitle: "闪耀的蛙4", // 章节标题
            imageUrls: [ // 图片URL数组
            "https://res.cloudinary.com/dayfb4276/image/upload/v1753244522/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_1_c1ylto.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244523/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_2_cqjnta.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244520/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_4_jeibxh.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244543/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_5_n4zixw.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244523/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_6_qds5nw.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244524/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_7_bjfdzc.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244521/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_8_dupp6a.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244523/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_9_s40hli.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244524/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_10_m9iyeg.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244525/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_11_ltgnft.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244529/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_12_aj0kyr.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244529/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_13_nhfglo.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244526/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_14_ut3t1o.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244526/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_15_jniaek.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244528/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_16_nichrt.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244530/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_17_hb9mdw.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244530/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_18_xo3ufr.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244530/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_19_czjcgj.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244540/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_20_n5wn1e.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244531/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_21_vhxkpv.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244533/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_22_ysweao.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244533/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_23_bxauve.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244533/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_24_yog7il.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244533/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_25_xowjvr.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244536/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_26_urqnno.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244536/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_27_gehkkx.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244536/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_28_kuia7k.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244540/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_29_lrulsf.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244539/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_30_hvisft.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244539/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_31_tvxe1l.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244539/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_32_cizcdo.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244542/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_34_j93a6w.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244543/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_35_zyf39t.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244543/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_36_px6ski.png",
"https://res.cloudinary.com/dayfb4276/image/upload/v1753244547/%E9%B9%AB%E5%B7%A2%E5%A4%96%E4%BC%A030_38_bike5p.png"
        ],
            staffMembers: [ // 制作人员
                { role: "图源", name: "lilocat" },
                { role: "修图", name: "桦冬" },
                { role: "翻译，嵌字巴拉巴拉", name: "deepseek和Deco" },
            ],
            talkContent: `<p>17页里，他们商量完规则之后小柴的那句：</p>
                             <p>要是不小心被鹫巢的自摸牵连，我的点棒也会减少，这很让人不安</p>
            <p>原文是：ヘタに振り込まれたいワシスのツモアガリで 俺の点棒が減るのも不安だろう</p>
                 <p>这句话我问了好几个AI，结果各有各的说法，我也不知道该听谁的，就把他们翻译的版本融合到了一起</p>
                   <p>懂日语的诸位如果有更好的翻译，可以评论私信我</p>
            `
        };
        
        // ========================
        // 脚本代码 - 无需修改
        // ========================
        
        document.addEventListener('DOMContentLoaded', function() {
            // 设置章节标题
            document.getElementById('chapterTitle').textContent = `鹫巢外传${chapterConfig.chapterNumber}`;
            document.getElementById('chapterSubtitle').textContent = `${chapterConfig.chapterTitle} | 中文汉化版`;
            
            // 设置制作人员
            const staffGrid = document.getElementById('staffGrid');
            chapterConfig.staffMembers.forEach(member => {
                const staffItem = document.createElement('div');
                staffItem.className = 'staff-item';
                staffItem.innerHTML = `
                    <div class="staff-role">${member.role}</div>
                    <div class="staff-name">${member.name}</div>
                `;
                staffGrid.appendChild(staffItem);
            });
            
            // 设置碎碎念内容
            document.getElementById('talkContent').innerHTML = chapterConfig.talkContent;
            
            const comicContainer = document.getElementById('comic-container');
            const statusBar = document.getElementById('statusBar');
            const loadedCount = document.getElementById('loadedCount');
            const totalCount = document.getElementById('totalCount');
            const progressBar = document.getElementById('progressBar');
            const header = document.getElementById('header');
            const footer = document.getElementById('footer');
            const statusBarEl = document.getElementById('statusBar');
            const navOverlay = document.getElementById('navOverlay');
            const prevBtn = document.getElementById('prevBtn');
            const homeBtn = document.getElementById('homeBtn');
            const nextBtn = document.getElementById('nextBtn');
            const endIndicator = document.getElementById('endIndicator');
            const talkSection = document.getElementById('talkSection');
            
            // 滚动变量
            let lastScrollTop = 0;
            let isNearBottom = false;
            
            totalCount.textContent = chapterConfig.imageUrls.length;
            
            // 移除加载提示
            comicContainer.innerHTML = '';
            
            // 创建并添加所有漫画图片
// 在现有代码中找到这部分，替换图片加载方式
chapterConfig.imageUrls.forEach((url, index) => {
    const imgContainer = document.createElement('div');
    imgContainer.className = 'img-container';
    
    const img = document.createElement('img');
    // 修改这里，初始时不加载图片
    img.dataset.src = url; // 使用data-src代替src
    img.alt = `第 ${index + 1} 页`;
    img.className = 'comic-image';
    img.loading = "lazy"; // 添加懒加载属性
    
    // 修改图片加载逻辑
    const loadImage = function() {
        if (img.dataset.src) {
            img.src = img.dataset.src;
            delete img.dataset.src;
        }
    };
    
    // 当图片进入视口时加载
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                loadImage();
                observer.unobserve(entry.target);
            }
        });
    });
    
    observer.observe(img);
    

    
                
                // 添加图片加载状态监听
                img.onload = function() {
                    this.classList.add('loaded');
                    
                    // 更新加载计数
                    const loaded = parseInt(loadedCount.textContent) + 1;
                    loadedCount.textContent = loaded;
                    
                    // 更新进度条
                    const progress = Math.floor((loaded / chapterConfig.imageUrls.length) * 100);
                    progressBar.style.width = `${progress}%`;
                    
                    // 当所有图片加载完成时
                    if (loaded === chapterConfig.imageUrls.length) {
                        setTimeout(() => {
                            statusBar.innerHTML = '<i class="fas fa-check-circle"></i> 所有图片加载完成!';
                            statusBar.style.color = '#28a745';
                            
                            // 将最后一页检测元素放在所有内容之后
                            document.body.appendChild(endIndicator);
                        }, 500);
                    }
                };
                
                img.onerror = function() {
                    this.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="600" viewBox="0 0 400 600"><rect width="400" height="600" fill="%23f8f9fa"/><text x="200" y="300" font-family="Arial" font-size="20" fill="%236c757d" text-anchor="middle">图片加载失败</text></svg>';
                    this.classList.add('loaded');
                    
                    // 更新加载计数
                    const loaded = parseInt(loadedCount.textContent) + 1;
                    loadedCount.textContent = loaded;
                    
                    // 更新进度条
                    const progress = Math.floor((loaded / chapterConfig.imageUrls.length) * 100);
                    progressBar.style.width = `${progress}%`;
                };
                
                // 添加页码标签
                const pageNum = document.createElement('div');
                pageNum.className = 'page-number';
                pageNum.textContent = `第 ${index + 1} 页`;
                pageNum.style.textAlign = 'center';
                pageNum.style.margin = '5px 0 15px';
                pageNum.style.color = '#6c757d';
                pageNum.style.fontSize = '0.9rem';
                
                imgContainer.appendChild(img);
                imgContainer.appendChild(pageNum);
                comicContainer.appendChild(imgContainer);
            });
            
            // 滚动时隐藏页眉页脚（优化版）
            window.addEventListener('scroll', function() {
                const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                const windowHeight = window.innerHeight;
                const documentHeight = Math.max(
                    document.body.scrollHeight, 
                    document.body.offsetHeight, 
                    document.documentElement.clientHeight, 
                    document.documentElement.scrollHeight, 
                    document.documentElement.offsetHeight
                );
                
                // 计算距离底部的距离
                const distanceToBottom = documentHeight - (currentScroll + windowHeight);
                
                // 如果接近底部（1200像素内），显示所有元素
                if (distanceToBottom < 1200) {
                    header.classList.remove('hidden');
                    footer.classList.remove('hidden');
                    statusBarEl.classList.remove('hidden');
                    isNearBottom = true;
                    return;
                } else {
                    isNearBottom = false;
                }
                
                // 向下滚动超过50px时隐藏
                if (currentScroll > lastScrollTop && currentScroll > 50) {
                    header.classList.add('hidden');
                    footer.classList.add('hidden');
                    statusBarEl.classList.add('hidden');
                } 
                // 向上滚动或到顶部时显示
                else {
                    header.classList.remove('hidden');
                    footer.classList.remove('hidden');
                    statusBarEl.classList.remove('hidden');
                }
                
                lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
            });
            
            // 点击中间区域显示导航菜单
            document.body.addEventListener('click', function(e) {
                // 排除按钮点击
                if (e.target.closest('.nav-btn')) return;
                
                // 切换导航菜单显示状态
                navOverlay.classList.toggle('active');
            });
            
            // 导航按钮功能
            prevBtn.addEventListener('click', function() {
                // 跳转到上一章
                window.location.href = `chapter${chapterConfig.chapterNumber - 1}.html`;
            });
            
            homeBtn.addEventListener('click', function() {
                // 跳转到目录页 - 修正为您的实际路径
                window.location.href = 'https://deco808.github.io/waxizi/index.html';
            });
            
            nextBtn.addEventListener('click', function() {
                // 跳转到下一章
                window.location.href = `chapter${chapterConfig.chapterNumber + 1}.html`;
            });
            
            // 初始时隐藏碎碎念区域，在滚动到末尾时显示
            talkSection.style.opacity = '0';
            talkSection.style.transform = 'translateY(20px)';
            talkSection.style.transition = 'all 0.5s ease';
            
            // 滚动到末尾时显示碎碎念区域
            window.addEventListener('scroll', function() {
                const talkSectionRect = talkSection.getBoundingClientRect();
                const windowHeight = window.innerHeight;
                
                // 当碎碎念区域进入视口时显示
                if (talkSectionRect.top < windowHeight * 0.8) {
                    talkSection.style.opacity = '1';
                    talkSection.style.transform = 'translateY(0)';
                }
            });
        });
    </script>
</body>
</html>
